<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EatlyHub | Food Delivery Platform</title>
    
    <!-- Meta Tags & PWA -->
    <meta name="description" content="Order food online from top local kitchens.">
    <meta name="theme-color" content="#ff4757">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3075/3075977.png">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --primary: #ff4757; 
            --primary-dark: #e84118;
            --secondary: #2f3542;
            --bg: #f1f2f6;
            --surface: #ffffff;
            --green: #2ed573;
            --red: #ff6b81;
            --yellow: #ffa502;
            --gray: #ced6e0;
            --shadow: 0 8px 24px rgba(149, 157, 165, 0.2);
            --font: 'Segoe UI', system-ui, -apple-system, sans-serif;
            --radius: 16px;
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: var(--font); background: var(--bg); color: var(--secondary); font-size: 14px; line-height: 1.5; overflow-x: hidden; padding-bottom: 80px; }
        
        /* --- UTILITY CLASSES --- */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .center { align-items: center; justify-content: center; }
        .justify-between { justify-content: space-between; }
        .w-100 { width: 100%; }
        .hidden { display: none !important; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-red { color: var(--primary); }
        .text-green { color: var(--green); }
        .text-white { color: white !important; }
        .text-gray { color: #747d8c; }
        .bold { font-weight: 700; }
        .pointer { cursor: pointer; }
        
        /* --- COMPONENTS --- */
        .btn { 
            padding: 14px 20px; border: none; border-radius: 12px; cursor: pointer; 
            font-weight: 600; font-size: 1rem; transition: transform 0.1s; 
            width: 100%; text-align: center; display: block; text-decoration: none; 
            margin-bottom: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative; overflow: hidden;
        }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-green { background: var(--green); color: white; }
        .btn-yellow { background: var(--yellow); color: white; }
        .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; box-shadow: none; }
        
        .card { 
            background: var(--surface); padding: 20px; border-radius: var(--radius); 
            box-shadow: var(--shadow); margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.03);
            animation: slideUp 0.3s ease-out;
        }
        
        .input-group { margin-bottom: 16px; position: relative; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: var(--secondary); }
        .input-group input, .input-group select, .input-group textarea { 
            width: 100%; padding: 14px; border: 2px solid #dfe4ea; border-radius: 12px; 
            font-size: 1rem; background: #ffffff; transition: all 0.2s; -webkit-appearance: none;
        }
        .input-group input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.1); }
        
        .file-upload-wrapper {
            border: 2px dashed #dfe4ea; border-radius: 12px; padding: 20px;
            text-align: center; cursor: pointer; background: #fdfdfd;
        }
        .file-upload-wrapper:hover { border-color: var(--primary); background: #fff5f6; }

        nav { 
            background: var(--surface); padding: 15px; position: sticky; top: 0; z-index: 100; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; 
        }
        .nav-brand { display: flex; align-items: center; gap: 8px; font-size: 1.4rem; font-weight: 900; color: var(--primary); }
        .nav-logo-svg { width: 32px; height: 32px; fill: var(--primary); }

        .tabs-wrapper { 
            background: var(--surface); border-bottom: 1px solid #eee; position: sticky; top: 62px; z-index: 90; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); width: 100%; overflow: hidden; 
        }
        .tabs-container { 
            display: flex; flex-wrap: nowrap; overflow-x: auto; padding: 10px 15px; 
            -webkit-overflow-scrolling: touch; scrollbar-width: none; gap: 10px; width: 100%;
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-btn { 
            padding: 10px 18px; white-space: nowrap; cursor: pointer; color: #747d8c; 
            font-weight: 600; border-radius: 20px; background: #f1f2f6; transition: all 0.2s; 
            font-size: 0.9rem; flex-shrink: 0;
        }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(255, 71, 87, 0.3); }

        .hero { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
            color: white; padding: 60px 20px 40px; text-align: center; 
            border-radius: 0 0 30px 30px; box-shadow: var(--shadow); margin-bottom: 20px;
        }

        .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; display: inline-block; cursor: pointer; }
        .st-new { background: #eafff3; color: #00b894; border: 1px solid #00b894; }
        .st-unverified { background: #fff0f0; color: var(--primary); border: 1px solid var(--primary); }
        
        .card.status-new { border-left: 5px solid var(--green); }
        .card.status-confirm { border-left: 5px solid var(--yellow); }
        .card.status-active { border-left: 5px solid #70a1ff; } 
        .card.status-ready { border-left: 5px solid #ff6b81; }
        .card.status-completed { border-left: 5px solid #2f3542; }
        .card.status-unpaid { border-left: 5px solid #ffa502; }

        /* --- SKELETON LOADING (Visual Delight) --- */
        .skeleton { background: #eee; background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%); border-radius: 5px; background-size: 200% 100%; animation: shine 1.5s linear infinite; }
        @keyframes shine { to { background-position-x: -200%; } }
        .sk-card { height: 120px; width: 100%; border-radius: 16px; margin-bottom: 15px; }
        .sk-text { height: 20px; width: 60%; margin-bottom: 10px; }

        /* --- STICKY NAV (Category Scroll) --- */
        .sticky-cat-nav {
            position: sticky; top: 0; z-index: 89; background: white; 
            padding: 15px 0 15px 15px; overflow-x: auto; white-space: nowrap; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; gap: 10px;
            -webkit-overflow-scrolling: touch; scrollbar-width: none;
        }
        .sticky-cat-nav::-webkit-scrollbar { display: none; }
        .cat-chip {
            padding: 8px 16px; background: #f1f2f6; border-radius: 20px; 
            color: var(--secondary); font-weight: 600; text-decoration: none; font-size: 0.9rem;
            transition: all 0.2s;
        }
        .cat-chip.active { background: var(--secondary); color: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

        /* --- BOTTOM SHEET MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: flex; justify-content: center; align-items: flex-end; backdrop-filter: blur(4px); opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-box { 
            background: white; width: 100%; max-width: 500px; padding: 25px; 
            border-radius: 25px 25px 0 0; max-height: 90vh; overflow-y: auto; 
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .modal-overlay.open .modal-box { transform: translateY(0); }
        @media(min-width: 600px) { 
            .modal-overlay { align-items: center; } 
            .modal-box { border-radius: 20px; }
        }

        /* --- STICKY CART BAR --- */
        .sticky-cart {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            padding: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1500;
            display: flex; justify-content: space-between; align-items: center;
            transform: translateY(100%); transition: transform 0.3s;
        }
        .sticky-cart.visible { transform: translateY(0); }

        /* --- UTILS --- */
        .bill-wrapper { 
            background: #fff; padding: 20px; border: 1px solid #eee; 
            box-shadow: 0 0 15px rgba(0,0,0,0.05); margin-top: 15px; 
            font-family: 'Courier New', monospace; position: relative; 
            background-image: radial-gradient(#eee 1px, transparent 1px); background-size: 10px 10px;
        }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideIn { from{opacity:0; transform:translateX(20px);} to{opacity:1; transform:translateX(0);} } 
        @keyframes fadeOut { from{opacity:1; transform:translateY(0);} to{opacity:0; transform:translateY(-20px);} } 

        /* Order Toggle */
        .order-toggle { display: flex; background: #f1f2f6; padding: 5px; border-radius: 12px; margin-bottom: 20px; }
        .toggle-opt { flex: 1; padding: 10px; text-align: center; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: 0.2s; }
        .toggle-opt.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

    </style>
</head>
<body>

<div id="app">
    <div style="height:100vh; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="loader"></div>
        <p class="mt-2 bold text-red">EatlyHub</p>
    </div>
</div>

<!-- ================= TEMPLATES ================= -->

<!-- 1. LANDING PAGE -->
<template id="tpl-landing">
    <div class="hero">
        <svg class="nav-logo-svg" viewBox="0 0 24 24" fill="white" style="width:80px;height:80px;margin-bottom:15px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
        </svg>
        <h1 style="color:white; font-size:2.5rem;">EatlyHub</h1>
        <p style="opacity:0.9; margin-bottom:20px;">All-in-One Platform for Hotels, Restaurants & Home Kitchens</p>
        <button class="btn" onclick="authLogin()" style="background:white; color:var(--primary); font-weight:800; border-radius:30px;">
            <svg style="width:20px;height:20px;vertical-align:middle;margin-right:8px;" viewBox="0 0 24 24"><path d="M12.545 10.239v3.821h5.445c-.712 2.315-2.647 3.972-5.445 3.972-3.332 0-6.033-2.531-6.033-5.97 0-3.438 2.701-5.97 6.033-5.97 1.414 0 2.675.525 3.636 1.35l2.802-2.818C17.396 2.922 15.115 1.761 12.545 1.761 6.615 1.761 1.76 6.345 1.76 12s4.855 10.239 10.785 10.239c6.234 0 10.39-4.313 10.39-10.239 0-.693-.061-1.373-.18-2.025l-10.21.264z"/></svg>
            Continue with Gmail
        </button>
        <div id="pwa-install-area" class="hidden mt-2">
            <button class="btn btn-outline text-white" style="border-color:white;" onclick="installPWA()">üì≤ Install App</button>
        </div>
    </div>
    <div class="container p-2">
        <h3 class="text-center mb-1">Why EatlyHub?</h3>
        <div class="card">
            <h4>üè® Hotels & Restaurants</h4>
            <p>Digital menus for room service. No hardware needed.</p>
        </div>
        <div class="card" style="border-left:5px solid var(--green);">
            <h4>üè† Home Based Kitchens</h4>
            <p>Start your food business today! Create a menu, get a link, and accept orders via WhatsApp.</p>
        </div>
    </div>
</template>

<!-- 2. DASHBOARD SHELL (User & Admin) -->
<template id="tpl-dashboard">
    <nav>
        <div class="nav-brand">
            <svg class="nav-logo-svg" viewBox="0 0 24 24"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
            EatlyHub <span id="admin-tag" class="hidden" style="font-size:0.7rem; background:black; color:white; padding:2px 5px; border-radius:5px; margin-left:5px;">ADMIN</span>
        </div>
        <button class="btn btn-secondary" style="width:auto; padding:8px 14px; font-size:0.85rem; margin:0; border-radius:20px;" onclick="authLogout()">Logout</button>
    </nav>
    <div class="tabs-wrapper">
        <div class="tabs-container" id="dash-tabs"></div>
    </div>
    <div id="dash-content" class="p-2" style="padding-bottom: 80px; max-width:800px; margin:0 auto;"></div>
</template>

<!-- ================= JAVASCRIPT LOGIC ================= -->

<script>
    // ============================================
    // IMPORTANT: REPLACE WITH YOUR ADMIN EMAIL
    // ============================================
    const ADMIN_EMAIL = "admin@eatlyhub.com"; 

    // --- 1. CONFIGURATION ---
    const firebaseConfig = {
      apiKey: "AIzaSyA4mlpgLA8l1N8VHqwpVLbPXvDvPxGPcSI",
      authDomain: "eatlyhub.firebaseapp.com",
      projectId: "eatlyhub",
      storageBucket: "eatlyhub.firebasestorage.app",
      messagingSenderId: "1094045089044",
      appId: "1:1094045089044:web:397e0fd73412a07c3ad601",
      measurementId: "G-V3K3QB1715"
    };

    try {
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    } catch(e) { console.error("Firebase Init Error", e); }
    
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // --- 2. STATE MANAGEMENT ---
    const app = document.getElementById('app');
    let currentUser = null;
    let bizProfile = {};
    let bizOrders = [];
    let bizReviews = [];
    let adminRequests = [];
    let currentTab = 'Dashboard';
    let deferredPrompt; // PWA

    const TABS = ['Dashboard', 'Profile', 'Open/Close', 'Add Foods', 'My Webpage', 'Reviews', 'New Orders', 'Confirmed Orders', 'Active Orders', 'Ready Orders', 'Completed Orders', 'Unpaid Bills', 'Reports', 'Admin Messages'];
    const ADMIN_TABS = ['Verification Requests', 'Admin Messages'];

    // Sound Notification
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playDing() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.value = 800; // High pitch ding
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.5);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.5);
    }

    // --- 3. IMAGE UTILITIES (Storage & Compression) ---
    function compressImage(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const scaleSize = 800 / img.width;
                    canvas.width = 800;
                    canvas.height = img.height * scaleSize;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', 0.7)); 
                };
                img.onerror = (err) => reject(err);
            };
            reader.onerror = (err) => reject(err);
        });
    }

    function uploadImageToStorage(base64DataUrl, path) {
        return new Promise((resolve, reject) => {
            const ref = storage.ref(path);
            const task = ref.putString(base64DataUrl, 'data_url');
            task.on('state_changed', null, (error) => reject(error), () => {
                task.snapshot.ref.getDownloadURL().then(resolve);
            });
        });
    }

    // --- 4. PWA & ROUTING ---
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        const installArea = document.getElementById('pwa-install-area');
        if(installArea) installArea.classList.remove('hidden');
    });

    function installPWA() {
        if(deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(() => deferredPrompt = null);
        }
    }

    window.addEventListener('load', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const bizId = urlParams.get('biz');
        const orderId = urlParams.get('orderId');

        if (bizId && orderId) {
            loadCustomerConfirmPage(bizId, orderId);
        } else if (bizId) {
            loadPublicPage(bizId);
        } else {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    if(user.email === ADMIN_EMAIL) loadAdminDashboard();
                    else loadDashboard();
                } else {
                    render('tpl-landing');
                }
            });
        }
    });

    function render(tplId) {
        app.innerHTML = '';
        const tpl = document.getElementById(tplId);
        if(tpl) app.appendChild(tpl.content.cloneNode(true));
    }

    function authLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(e => showToast("Login Error: " + e.message, 'error'));
    }
    
    function authLogout() { 
        auth.signOut().then(() => window.location.reload()); 
    }

    // --- 5. USER DASHBOARD LOGIC ---
    async function loadDashboard() {
        render('tpl-dashboard');
        const tabsContainer = document.getElementById('dash-tabs');
        tabsContainer.innerHTML = TABS.map(t => `<div class="tab-btn" onclick="switchTab('${t}')">${t}</div>`).join('');

        db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
            if(doc.exists) bizProfile = doc.data();
            else {
                bizProfile = { locked: false, verified: false, foods: [], schedule: {}, heroText: 'Welcome!', socialLinks: {} };
                db.collection('users').doc(currentUser.uid).set(bizProfile);
            }
            refreshTabContent(); 
        });

        // Real-time Orders with Sound Notification
        let firstLoad = true;
        db.collection('users').doc(currentUser.uid).collection('orders').orderBy('time', 'desc').limit(50).onSnapshot(snap => {
            const oldSize = bizOrders.length;
            bizOrders = snap.docs.map(d => ({id: d.id, ...d.data()}));
            
            // Play sound if new order (not on first load)
            if(!firstLoad && bizOrders.length > oldSize) {
                const latest = bizOrders[0];
                if(latest.status === 'new') {
                    showToast("üîî New Order Received!");
                    try { playDing(); } catch(e){}
                }
            }
            firstLoad = false;
            refreshTabContent();
        });
          
        db.collection('users').doc(currentUser.uid).collection('reviews').orderBy('time', 'desc').limit(20).onSnapshot(snap => {
            bizReviews = snap.docs.map(d => ({id: d.id, ...d.data()}));
            refreshTabContent();
        });

        switchTab('Dashboard');
    }

    function switchTab(name) {
        if (name !== 'Dashboard' && name !== 'Profile' && name !== 'Admin Messages' && (!bizProfile.locked)) {
            showToast("‚ö† Please complete & LOCK Profile first.", "error");
            name = 'Profile';
        }
        currentTab = name;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText === name));
        
        // Resume audio context on user interaction
        if(audioCtx.state === 'suspended') audioCtx.resume();
        
        refreshTabContent();
    }

    function refreshTabContent() {
        const container = document.getElementById('dash-content');
        if (!container || !currentUser) return;
        container.innerHTML = ''; 

        if(currentTab === 'Dashboard') renderDashHome(container);
        else if(currentTab === 'Profile') renderProfile(container);
        else if(currentTab === 'Open/Close') renderSchedule(container);
        else if(currentTab === 'Add Foods') renderAddFoods(container);
        else if(currentTab === 'My Webpage') renderWebpageInfo(container);
        else if(currentTab === 'Reviews') renderReviews(container);
        else if(currentTab === 'Reports') renderReports(container);
        else if(currentTab === 'Admin Messages') renderAdminChat(container);
        else renderOrdersList(container, currentTab);
    }

    // --- DASHBOARD TABS ---
    function renderDashHome(target) {
        const newCount = bizOrders.filter(o => o.status === 'new').length;
        const activeCount = bizOrders.filter(o => ['confirmed', 'active', 'ready'].includes(o.status)).length;
        const completedCount = bizOrders.filter(o => o.status === 'completed').length;
        const totalRev = bizOrders.filter(o => o.status === 'completed').reduce((a,b) => a + Number(b.total), 0);

        target.innerHTML = `
            <div class="card center flex-col">
                <img src="${bizProfile.logo || 'https://cdn-icons-png.flaticon.com/512/847/847969.png'}" style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:10px;border:4px solid var(--primary);">
                <h3>${bizProfile.businessName || 'Setup Your Business'}</h3>
                ${bizProfile.verified ? '<div class="status-badge st-new">‚úî Verified</div>' : '<div class="status-badge st-unverified">‚ùå Not Verified</div>'}
            </div>
            <div class="flex" style="gap:10px; margin-bottom:20px;">
                <div class="card w-100 text-center" style="margin:0; background:var(--primary); color:white;" onclick="switchTab('New Orders')">
                    <h1>${newCount}</h1><small style="color:white;">New</small>
                </div>
                <div class="card w-100 text-center" style="margin:0;" onclick="switchTab('Active Orders')">
                    <h1>${activeCount}</h1><small>Kitchen</small>
                </div>
            </div>
            <div class="card">
                <h4>üìä Quick Stats</h4>
                <div class="flex justify-between" style="border-bottom:1px solid #eee; padding:5px 0;"><span>Revenue</span><b>Rs. ${totalRev.toLocaleString()}</b></div>
                <div class="flex justify-between" style="padding:5px 0;"><span>Orders</span><b>${completedCount}</b></div>
            </div>
        `;
    }

    // --- PROFILE TAB ---
    function renderProfile(target) {
        const p = bizProfile;
        const disabled = p.locked ? 'disabled' : '';
        
        let logoHtml = p.logo ? 
            `<img src="${p.logo}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;">` : 
            `<label class="btn btn-secondary">Upload Logo <input type="file" hidden onchange="handleImageUpload(this, 'logo')"></label>`;

        target.innerHTML = `
            <div class="card">
                <h3>Business Profile</h3>
                <div class="center flex-col mb-1">${logoHtml}</div>
                <div class="input-group"><label>Business Name</label><input id="p-name" value="${p.businessName||''}" ${disabled}></div>
                <div class="input-group"><label>Address</label><textarea id="p-addr" ${disabled}>${p.address||''}</textarea></div>
                <div class="input-group"><label>Owner Name</label><input id="p-owner" value="${p.ownerName||''}" ${disabled}></div>
                <div class="input-group"><label>Hotline</label><input id="p-hot" type="tel" value="${p.hotline||''}" ${disabled}></div>
                <div class="input-group"><label>WhatsApp</label><input id="p-wa" type="tel" value="${p.whatsapp||''}" ${disabled}></div>
                ${p.locked ? `<button class="btn btn-yellow" onclick="toggleLock(false)">Unlock to Edit</button>` : `<button class="btn btn-primary" onclick="saveProfile()">Save & Lock</button>`}
            </div>
        `;
    }

    async function handleImageUpload(input, type) {
        if (input.files[0]) {
            showToast("Uploading...", "info");
            const base64 = await compressImage(input.files[0]);
            const url = await uploadImageToStorage(base64, `images/${currentUser.uid}/${type}_${Date.now()}.jpg`);
            if(type === 'logo') {
                bizProfile.logo = url;
                renderProfile(document.getElementById('dash-content')); // Refresh UI
            } else {
                // For verification docs
                bizProfile['temp_' + type] = url;
                showToast("Document Uploaded");
            }
        }
    }

    function saveProfile() {
        const name = document.getElementById('p-name').value;
        const addr = document.getElementById('p-addr').value;
        const owner = document.getElementById('p-owner').value;
        const hot = document.getElementById('p-hot').value;
        const wa = document.getElementById('p-wa').value;

        if(!bizProfile.logo || !name || !wa) return showToast("Logo, Name & WhatsApp required!", "error");

        db.collection('users').doc(currentUser.uid).update({
            businessName: name, address: addr, ownerName: owner, 
            hotline: hot, whatsapp: wa, logo: bizProfile.logo, locked: true
        }).then(() => { showToast("Saved"); switchTab('Dashboard'); });
    }

    function toggleLock(state) {
        db.collection('users').doc(currentUser.uid).update({locked: state});
    }

    // --- SCHEDULE TAB ---
    function renderSchedule(target) {
        const today = new Date().toLocaleDateString('en-US', {weekday:'long'});
        const s = bizProfile.schedule?.[today] || {open: false, start:'08:00', end:'20:00'};
        
        target.innerHTML = `
            <div class="card">
                <h3>üìÖ ${today} Schedule</h3>
                <div class="input-group">
                    <label>Status</label>
                    <select id="oc-stat" onchange="saveSched('${today}')">
                        <option value="yes" ${s.open?'selected':''}>Open</option>
                        <option value="no" ${!s.open?'selected':''}>Closed</option>
                    </select>
                </div>
                <div class="flex" style="gap:10px;">
                    <div class="input-group w-100"><label>Open</label><input type="time" id="oc-start" value="${s.start}" onchange="saveSched('${today}')"></div>
                    <div class="input-group w-100"><label>Close</label><input type="time" id="oc-end" value="${s.end}" onchange="saveSched('${today}')"></div>
                </div>
            </div>
        `;
    }

    function saveSched(day) {
        const open = document.getElementById('oc-stat').value === 'yes';
        const start = document.getElementById('oc-start').value;
        const end = document.getElementById('oc-end').value;
        const schedule = bizProfile.schedule || {};
        schedule[day] = { open, start, end };
        db.collection('users').doc(currentUser.uid).update({ schedule }).then(()=>showToast("Schedule Saved"));
    }

    // --- ADD FOODS TAB (Full Implementation) ---
    let tempFoodImg = null;
    function renderAddFoods(target) {
        target.innerHTML = `
            <div class="card">
                <h3>Add New Item</h3>
                <div class="file-upload-wrapper" onclick="document.getElementById('f-file').click()">
                    <span id="f-file-txt">${tempFoodImg ? 'Image Selected' : 'Click to Upload Image'}</span>
                    <input type="file" id="f-file" hidden onchange="handleFoodImg(this)">
                </div>
                <img id="f-prev" src="${tempFoodImg || ''}" class="${tempFoodImg?'':'hidden'} mt-1" style="width:100%;height:150px;object-fit:cover;border-radius:10px;">
                <div class="input-group mt-1"><label>Category</label><input id="f-cat" placeholder="e.g. Pizza"></div>
                <div class="input-group"><label>Name</label><input id="f-name" placeholder="Item Name"></div>
                <div class="flex" style="gap:10px">
                    <div class="input-group w-100"><label>Half Price</label><input id="f-half" type="number"></div>
                    <div class="input-group w-100"><label>Full Price</label><input id="f-full" type="number"></div>
                </div>
                <button class="btn btn-green" onclick="addFood()">+ Add to Menu</button>
            </div>
            <h3>Menu</h3>
            <div id="menu-list">
                ${(bizProfile.foods||[]).map((f,i) => `
                    <div class="card flex justify-between center" style="padding:10px;">
                        <div class="flex center">
                            <img src="${f.img}" style="width:50px;height:50px;border-radius:8px;object-fit:cover;margin-right:10px;">
                            <div><b>${f.name}</b><br><small>${f.cat}</small></div>
                        </div>
                        <button class="btn btn-secondary" style="width:auto;padding:5px 10px;" onclick="deleteFood(${i})">üóë</button>
                    </div>
                `).join('')}
            </div>
        `;
    }

    async function handleFoodImg(input) {
        if(input.files[0]) {
            showToast("Uploading...", "info");
            const base64 = await compressImage(input.files[0]);
            tempFoodImg = await uploadImageToStorage(base64, `food_images/${currentUser.uid}/${Date.now()}.jpg`);
            renderAddFoods(document.getElementById('dash-content')); // Refresh to show preview
        }
    }

    function addFood() {
        const cat = document.getElementById('f-cat').value;
        const name = document.getElementById('f-name').value;
        const half = document.getElementById('f-half').value;
        const full = document.getElementById('f-full').value;

        if(!tempFoodImg || !name) return showToast("Image & Name required", "error");

        const foods = [...(bizProfile.foods||[]), {cat, name, img: tempFoodImg, half, full}];
        db.collection('users').doc(currentUser.uid).update({foods}).then(() => {
            tempFoodImg = null;
            renderAddFoods(document.getElementById('dash-content'));
            showToast("Added!");
        });
    }

    function deleteFood(idx) {
        if(!confirm("Delete?")) return;
        const foods = bizProfile.foods.filter((_, i) => i !== idx);
        db.collection('users').doc(currentUser.uid).update({foods}).then(() => renderAddFoods(document.getElementById('dash-content')));
    }

    // --- REPORTS TAB (Chart.js) ---
    function renderReports(target) {
        const canvasId = 'revChart';
        const completed = bizOrders.filter(o => o.status === 'completed');
        const revenue = completed.reduce((a,b) => a + Number(b.total), 0);

        // Group by Date
        const salesData = {};
        completed.forEach(o => {
            const date = new Date(o.time).toLocaleDateString();
            salesData[date] = (salesData[date] || 0) + o.total;
        });

        target.innerHTML = `
            <div class="card text-center">
                <h3>üìä Analytics</h3>
                <h1 class="text-green">Rs. ${revenue.toLocaleString()}</h1>
                <small>Total Revenue</small>
                <div style="height:250px; margin-top:20px;"><canvas id="${canvasId}"></canvas></div>
            </div>
        `;

        setTimeout(() => {
            const ctx = document.getElementById(canvasId);
            if(ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Object.keys(salesData),
                        datasets: [{ label: 'Sales (Rs)', data: Object.values(salesData), borderColor: '#ff4757', tension: 0.3 }]
                    }
                });
            }
        }, 100);
    }

    // --- QR CODE & WEBPAGE ---
    function renderWebpageInfo(target) {
        const url = `${window.location.origin}${window.location.pathname}?biz=${currentUser.uid}`;
        
        target.innerHTML = `
            <div class="card text-center">
                <h3>Share Your Shop</h3>
                <input class="w-100 p-2 mb-1" value="${url}" readonly style="background:#eee;border:none;border-radius:8px;">
                <div class="flex center" style="gap:10px">
                    <a href="${url}" target="_blank" class="btn btn-primary">Open</a>
                    <button class="btn btn-secondary" onclick="generateQR('${url}')">üñ® QR Poster</button>
                </div>
                <div id="qr-container" class="mt-2 center flex-col hidden" style="background:white; padding:20px; border:2px dashed #ddd;">
                    <div id="qrcode"></div>
                    <h3 class="mt-1">Scan to Order</h3>
                    <p>${bizProfile.businessName}</p>
                </div>
            </div>
            <div class="card">
                <h3>Settings</h3>
                <div class="input-group"><label>Welcome Message</label><input id="hero-txt" value="${bizProfile.heroText||''}" onchange="updateWebSettings()"></div>
                <div class="input-group"><label>YouTube Link</label><input id="s-yt" value="${bizProfile.socialLinks?.yt||''}" placeholder="Paste URL" onchange="updateWebSettings()"></div>
            </div>
        `;
    }

    function generateQR(url) {
        document.getElementById('qr-container').classList.remove('hidden');
        document.getElementById('qrcode').innerHTML = '';
        new QRCode(document.getElementById('qrcode'), { text: url, width: 128, height: 128 });
    }

    function updateWebSettings() {
        const heroText = document.getElementById('hero-txt').value;
        const yt = document.getElementById('s-yt').value;
        db.collection('users').doc(currentUser.uid).update({heroText, socialLinks: {yt}}).then(()=>showToast("Saved"));
    }

    // --- REVIEWS & CHAT ---
    function renderReviews(t) {
        t.innerHTML = bizReviews.map(r => `
            <div class="card">
                <b>${r.name}</b> <span class="text-yellow">${'‚òÖ'.repeat(r.stars)}</span>
                <p>${r.text}</p>
                <div class="flex" style="gap:5px">${r.status==='pending' ? `<button class="btn btn-green" onclick="updateReview('${r.id}','published')">Approve</button>` : ''}<button class="btn btn-outline" onclick="deleteReview('${r.id}')">Delete</button></div>
            </div>
        `).join('') || '<div class="card">No reviews</div>';
    }
    function updateReview(id, s) { db.collection('users').doc(currentUser.uid).collection('reviews').doc(id).update({status:s}); }
    function deleteReview(id) { if(confirm("Delete?")) db.collection('users').doc(currentUser.uid).collection('reviews').doc(id).delete(); }
    
    function renderAdminChat(t) { t.innerHTML = `<div class="card"><h3>Support</h3><p>Chat feature coming soon.</p></div>`; }

    // --- ORDERS LIST ---
    function renderOrdersList(target, tabName) {
        const map = {'New Orders':'new','Confirmed Orders':'confirmed','Active Orders':'active','Ready Orders':'ready','Completed Orders':'completed'};
        const status = map[tabName];
        if(!status) return;
        const list = bizOrders.filter(o => o.status === status);
        
        target.innerHTML = list.length ? list.map(o => `
            <div class="card status-${status}">
                <div class="flex justify-between"><h4>#${o.orderNum}</h4><small>${o.status}</small></div>
                <b>${o.custName} (${o.orderType || 'Delivery'})</b>
                <div style="background:#f8f9fa; padding:10px;">${o.items.map(i=>`<div>${i.count}x ${i.name} (${i.variant})</div>`).join('')}</div>
                <div class="mt-1 flex" style="gap:5px">
                    ${status==='new' ? `<button class="btn btn-yellow" onclick="reqConfirm('${o.id}','${o.custWa}')">Confirm</button>` : ''}
                    ${status==='confirmed' ? `<button class="btn btn-primary" onclick="setStatus('${o.id}','active')">Cook</button>` : ''}
                    ${status==='active' ? `<button class="btn btn-green" onclick="setStatus('${o.id}','ready')">Ready</button>` : ''}
                    ${status==='ready' ? `<button class="btn btn-secondary" onclick="setStatus('${o.id}','completed')">Finish</button>` : ''}
                </div>
            </div>
        `).join('') : '<p class="text-center p-2">No orders</p>';
    }

    function setStatus(id, s) { db.collection('users').doc(currentUser.uid).collection('orders').doc(id).update({status:s}); }
    function reqConfirm(id, wa) { window.open(`https://wa.me/${wa}?text=Please confirm your order`); }

    // --- ADMIN DASHBOARD ---
    function loadAdminDashboard() {
        render('tpl-dashboard');
        document.getElementById('admin-tag').classList.remove('hidden');
        document.getElementById('dash-tabs').innerHTML = ADMIN_TABS.map(t => `<div class="tab-btn" onclick="switchAdminTab('${t}')">${t}</div>`).join('');
        
        db.collection('admin_requests').onSnapshot(snap => {
            adminRequests = snap.docs.map(d => ({id: d.id, ...d.data()}));
            refreshAdminContent();
        });
        switchAdminTab('Verification Requests');
    }
    
    function switchAdminTab(name) { currentTab = name; refreshAdminContent(); }
    
    function refreshAdminContent() {
        const c = document.getElementById('dash-content');
        if(currentTab === 'Verification Requests') {
            c.innerHTML = adminRequests.map(r => `
                <div class="card">
                    <h4>${r.name}</h4>
                    <button class="btn btn-green" onclick="approveUser('${r.uid}','${r.id}')">Approve</button>
                </div>
            `).join('') || '<div class="card">No requests</div>';
        } else c.innerHTML = '<div class="card">Messages</div>';
    }

    function approveUser(uid, rid) {
        db.collection('users').doc(uid).update({verified:true}).then(() => {
            db.collection('admin_requests').doc(rid).delete();
            showToast("Verified");
        });
    }

    // ================= PUBLIC PAGE (CUSTOMER VIEW) =================
    let cart = [];
    let bizOwnerWa = null;
    let selectedOrderType = 'Delivery'; 

    async function loadPublicPage(bizId) {
        app.innerHTML = renderSkeleton(); // Visual Delight: Skeleton
        
        try {
            const doc = await db.collection('users').doc(bizId).get();
            if(!doc.exists) return app.innerHTML = "<h2>Not Found</h2>";
            const data = doc.data();
            bizOwnerWa = data.whatsapp;

            document.title = `${data.businessName} | Order Online`;
            
            app.innerHTML = `
                <div class="sticky-cat-nav" id="cat-nav"></div>
                <div class="hero" style="border-radius:0 0 20px 20px; padding:30px 20px;">
                    <img src="${data.logo}" style="width:80px;height:80px;border-radius:50%;border:3px solid white;">
                    <h2>${data.businessName}</h2>
                    <p>${data.heroText}</p>
                </div>
                <div class="container p-2">
                    <div class="order-toggle">
                        <div class="toggle-opt active" onclick="setOrderType(this, 'Delivery')">Delivery</div>
                        <div class="toggle-opt" onclick="setOrderType(this, 'Pick-up')">Pick-up</div>
                        <div class="toggle-opt" onclick="setOrderType(this, 'Dine-in')">Dine-in</div>
                    </div>
                    <div id="menu-area"></div>
                </div>
                <div class="sticky-cart" id="sticky-cart" onclick="showCartModal()">
                    <div><div class="bold" style="font-size:1.1rem" id="cart-total">Rs. 0</div><small id="cart-count">0 Items</small></div>
                    <div class="bold text-red">View Cart ></div>
                </div>
            `;

            const menuDiv = document.getElementById('menu-area');
            const navDiv = document.getElementById('cat-nav');
            const cats = [...new Set((data.foods||[]).map(f => f.cat))];
            
            cats.forEach(c => {
                navDiv.innerHTML += `<a href="#cat-${c}" class="cat-chip">${c}</a>`;
                menuDiv.innerHTML += `<h3 id="cat-${c}" class="mt-2 text-red">${c}</h3>`;
                data.foods.filter(f => f.cat === c).forEach(f => {
                    const fStr = JSON.stringify(f).replace(/"/g, '&quot;');
                    menuDiv.innerHTML += `
                        <div class="card flex justify-between center" onclick="openFoodModal(${fStr})">
                            <div style="flex:1"><div class="bold">${f.name}</div><div class="text-green bold">Rs. ${f.full || f.half}</div></div>
                            <img src="${f.img}" style="width:80px;height:80px;border-radius:12px;object-fit:cover;">
                        </div>
                    `;
                });
            });

        } catch (e) { console.log(e); app.innerHTML = "Error loading."; }
    }

    function renderSkeleton() {
        return `<div class="p-2"><div class="skeleton" style="height:200px; border-radius:20px; margin-bottom:20px;"></div><div class="skeleton sk-text"></div><div class="skeleton sk-card"></div><div class="skeleton sk-card"></div></div>`;
    }

    function setOrderType(el, type) {
        document.querySelectorAll('.toggle-opt').forEach(e => e.classList.remove('active'));
        el.classList.add('active');
        selectedOrderType = type;
        showToast(`Switched to ${type}`, 'info');
    }

    // --- FOOD MODAL ---
    let currentFood = null;
    function openFoodModal(food) {
        currentFood = food;
        const modalHtml = `
            <div class="center flex-col">
                <img src="${food.img}" style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:10px;">
                <h3>${food.name}</h3>
            </div>
            <div class="mt-2">
                <label class="bold">Size</label>
                ${food.half ? `<div class="p-1 flex justify-between"><label><input type="radio" name="size" value="Half" data-price="${food.half}"> Half</label> <b>${food.half}</b></div>` : ''}
                ${food.full ? `<div class="p-1 flex justify-between"><label><input type="radio" name="size" value="Full" data-price="${food.full}" checked> Full</label> <b>${food.full}</b></div>` : ''}
            </div>
            <div class="mt-2">
                <label class="bold">Add-ons</label>
                <div class="p-1 flex justify-between"><label><input type="checkbox" class="addon" value="Cheese" data-price="50"> Extra Cheese</label> <b>+50</b></div>
                <div class="p-1 flex justify-between"><label><input type="checkbox" class="addon" value="Spicy" data-price="20"> Spicy Sauce</label> <b>+20</b></div>
            </div>
            <div class="input-group mt-2"><label>Notes</label><textarea id="f-note" placeholder="No onions..." rows="2"></textarea></div>
            <button class="btn btn-primary mt-2" onclick="addToCartFromModal()">Add to Cart</button>
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        `;
        showModal(modalHtml);
    }

    function addToCartFromModal() {
        const sizeEl = document.querySelector('input[name="size"]:checked');
        if(!sizeEl) return showToast("Select Size", "error");
        
        let price = Number(sizeEl.getAttribute('data-price'));
        let addons = [];
        document.querySelectorAll('.addon:checked').forEach(el => {
            price += Number(el.getAttribute('data-price'));
            addons.push(el.value);
        });

        cart.push({
            name: currentFood.name,
            variant: sizeEl.value,
            price: price,
            addons: addons,
            note: document.getElementById('f-note').value,
            count: 1
        });

        updateCartUI();
        closeModal();
        showToast("Added to Cart");
    }

    function updateCartUI() {
        const total = cart.reduce((a,b) => a + b.price, 0);
        document.getElementById('cart-total').innerText = `Rs. ${total}`;
        document.getElementById('cart-count').innerText = `${cart.length} Items`;
        
        const bar = document.getElementById('sticky-cart');
        if(cart.length > 0) bar.classList.add('visible');
        else bar.classList.remove('visible');
    }

    function showCartModal() {
        if(!cart.length) return;
        const total = cart.reduce((a,b) => a + b.price, 0);
        const list = cart.map((i, idx) => `
            <div style="border-bottom:1px solid #eee; padding:10px 0;">
                <div class="flex justify-between"><b>${i.name} (${i.variant})</b> <b>${i.price}</b></div>
                <small>${i.addons.join(', ')} ${i.note ? '| ' + i.note : ''}</small>
                <div class="text-right"><span class="text-red pointer" onclick="removeFromCart(${idx})">Remove</span></div>
            </div>
        `).join('');

        showModal(`
            <h3>Your Cart (${selectedOrderType})</h3>
            <div style="max-height:300px; overflow-y:auto;">${list}</div>
            <div class="flex justify-between bold mt-2" style="font-size:1.2rem"><span>Total</span><span>Rs. ${total}</span></div>
            <div class="input-group mt-1"><input id="c-name" placeholder="Name"></div>
            <div class="input-group"><input id="c-wa" type="tel" placeholder="WhatsApp Number"></div>
            ${selectedOrderType === 'Dine-in' ? '<div class="input-group"><input id="c-extra" placeholder="Table Number"></div>' : ''}
            ${selectedOrderType === 'Delivery' ? '<div class="input-group"><input id="c-extra" placeholder="Address"></div>' : ''}
            <button class="btn btn-green mt-1" onclick="submitOrder()">Place Order via WhatsApp</button>
        `);
    }

    function removeFromCart(idx) { cart.splice(idx, 1); updateCartUI(); closeModal(); if(cart.length) showCartModal(); }

    function submitOrder() {
        const name = document.getElementById('c-name').value;
        const wa = document.getElementById('c-wa').value;
        const extra = document.getElementById('c-extra') ? document.getElementById('c-extra').value : '';
        const total = cart.reduce((a,b) => a + b.price, 0);
        
        if(!name || !wa) return showToast("Name & WhatsApp required", "error");

        const orderData = {
            orderNum: Math.floor(10000 + Math.random() * 90000).toString(),
            custName: name, custWa: wa, items: cart, total: total,
            status: 'new', orderType: selectedOrderType, time: new Date().toISOString()
        };

        const bizId = new URLSearchParams(window.location.search).get('biz');
        
        db.collection('users').doc(bizId).collection('orders').add(orderData).then(() => {
            const msg = `New Order (${selectedOrderType})%0A%0AName: ${name}%0AExtra: ${extra}%0ATotal: Rs. ${total}`;
            window.open(`https://wa.me/${bizOwnerWa}?text=${msg}`);
            cart = []; updateCartUI(); closeModal();
        });
    }

    // ================= CUSTOMER CONFIRMATION PAGE =================
    async function loadCustomerConfirmPage(bizId, orderId) {
        const docRef = db.collection('users').doc(bizId).collection('orders').doc(orderId);
        const doc = await docRef.get();
        if(!doc.exists) return app.innerHTML = "<div class='text-center p-2'><h2>Order not found</h2></div>";
        const o = doc.data();

        let buttonHtml = `<button class="btn btn-secondary mt-1" onclick="window.close()">Close</button>`;
        if (o.status === 'new') {
            buttonHtml = `
                <button class="btn btn-green" onclick="confirmAction('${bizId}', '${orderId}', 'confirmed')">‚úÖ CONFIRM</button>
                <button class="btn btn-secondary mt-1" style="background:#ff6b81" onclick="confirmAction('${bizId}', '${orderId}', 'canceled')">‚ùå CANCEL</button>
            `;
        }

        app.innerHTML = `
            <div class="flex-col center p-2" style="min-height:100vh; background:white;">
                <h2 class="text-green mb-1">Confirm Order</h2>
                <h1 style="font-size:3rem; margin:0;">${o.orderNum}</h1>
                <div class="card w-100" style="max-width:400px; text-align:left;">
                    ${o.items.map(i => `<div class="flex justify-between p-1" style="border-bottom:1px solid #eee"><span>${i.name}</span><span>Rs. ${i.price}</span></div>`).join('')}
                    <div class="flex justify-between bold p-1" style="font-size:1.2rem"><span>Total</span><span>Rs. ${o.total}</span></div>
                </div>
                <div class="w-100 mt-2" style="max-width:400px">${buttonHtml}</div>
            </div>
        `;
    }

    function confirmAction(bizId, orderId, status) {
        db.collection('users').doc(bizId).collection('orders').doc(orderId).update({status, seen: true})
        .then(() => { app.innerHTML = `<div style="height:100vh;display:flex;align-items:center;justify-content:center;"><h1>${status}</h1></div>`; });
    }

    // ================= UTILITIES =================
    function showModal(content) {
        let ol = document.querySelector('.modal-overlay');
        if(!ol) {
            ol = document.createElement('div');
            ol.className = 'modal-overlay';
            ol.innerHTML = `<div class="modal-box"></div>`;
            document.body.appendChild(ol);
            ol.onclick = (e) => { if(e.target === ol) closeModal(); }
        }
        ol.querySelector('.modal-box').innerHTML = content;
        setTimeout(() => ol.classList.add('open'), 10);
    }
    
    function closeModal() {
        const ol = document.querySelector('.modal-overlay');
        if(ol) {
            ol.classList.remove('open');
            setTimeout(() => ol.remove(), 300);
        }
    }

    function showToast(msg, type='success') {
        const t = document.createElement('div');
        t.innerText = msg;
        t.style = `position:fixed;top:20px;right:20px;z-index:2000;background:${type==='error'?'#ff4757':'#2ed573'};color:white;padding:12px 20px;border-radius:50px;box-shadow:0 10px 30px rgba(0,0,0,0.2);animation:slideIn 0.3s;`;
        document.body.appendChild(t);
        setTimeout(() => { t.style.animation='fadeOut 0.3s forwards'; setTimeout(()=>t.remove(),300); }, 3000);
    }
</script>
</body>
</html>
